// --- THE CANON OF LOGOS (Standard Library) ---

// ==========================================
// I. THE BOOK OF NUMBERS (Mathematics)
// ==========================================

ministry abs(x: HolyInt) -> HolyInt {
    inspect (x < 0) {
        case Verily: offer 0 - x;
        case Nay:    offer x;
    } amen
} amen

ministry max(a: HolyInt, b: HolyInt) -> HolyInt {
    inspect (a > b) {
        case Verily: offer a;
        case Nay:    offer b;
    } amen
} amen

ministry min(a: HolyInt, b: HolyInt) -> HolyInt {
    inspect (a < b) {
        case Verily: offer a;
        case Nay:    offer b;
    } amen
} amen

ministry pow(base: HolyInt, exp: HolyInt) -> HolyInt {
    inspect (exp == 0) {
        case Verily: offer 1;
        case Nay:    offer base * pow(base, exp - 1);
    } amen
} amen

// ==========================================
// II. THE BOOK OF WORDS (String Manipulation)
// ==========================================

ministry is_empty(s: Text) -> Bool {
    offer measure(s) == 0;
} amen

ministry equals(s1: Text, s2: Text) -> Bool {
    offer s1 == s2;
} amen

ministry chant(s: Text, count: HolyInt) -> Text {
    inspect (count <= 0) {
        case Verily: offer "";
        case Nay:    offer s + chant(s, count - 1);
    } amen
} amen

// ==========================================
// III. THE BOOK OF REVELATION (I/O Helpers)
// ==========================================

service say(msg: Text) {
    behold msg;
} amen

service say_int(n: HolyInt) {
    behold n;
} amen

ministry ask(prompt: Text) -> Text {
    gift response : Text = listen prompt;
    offer response;
} amen

ministry ask_int(prompt: Text) -> HolyInt {
    gift txt : Text = listen prompt;
    try {
        offer witness txt as HolyInt;
    } repent e {
        // If input is not a HolyInt, return 0 by convention.
        offer 0;
    } amen
} amen

// ==========================================
// IV. THE BOOK OF LOGIC (Boolean Helpers)
// ==========================================

ministry not(b: Bool) -> Bool {
    inspect (b) {
        case Verily: offer Nay;
        case Nay:    offer Verily;
    } amen
} amen

ministry and(a: Bool, b: Bool) -> Bool {
    inspect (a) {
        case Verily: offer b;
        case Nay:    offer Nay;
    } amen
} amen

ministry or(a: Bool, b: Bool) -> Bool {
    inspect (a) {
        case Verily: offer Verily;
        case Nay:    offer b;
    } amen
} amen




# The Book of Genesis: Standard Library for LOGOS
# Scrolls (File I/O), Chronos (Time), and The Cosmos (Environment)

# --- CHAPTER 1: SCROLLS (File I/O) ---

structure Scroll {
    path: Text;
    fd: HolyInt; # 0 signifies a broken seal
} amen

service open_scroll(path: Text, mode: HolyInt) -> Scroll {
    gift handle : HolyInt = __sys_open(path, mode);

    offer new Scroll {
        path = path,
        fd = handle
    };
} amen

service close_scroll(s: Scroll) -> Void {
    __sys_close(s.fd);
} amen

service write_line(s: Scroll, content: Text) -> Bool {
    inspect ((s.fd == 0)) {
        case Verily: offer Nay;
        case _: pass;
    } amen

    offer __sys_write(s.fd, (content + "\n"));
} amen

service read_segment(s: Scroll, length: HolyInt) -> Text {
    inspect ((s.fd == 0)) {
        case Verily: offer "";
        case _: pass;
    } amen

    offer __sys_read(s.fd, length);
} amen


# --- CHAPTER 2: CHRONOS (Time) ---

service now() -> HolyInt {
    offer __sys_time();
} amen

service since(start_time: HolyInt) -> HolyInt {
    gift current : HolyInt = now();
    offer (current - start_time);
} amen


# --- CHAPTER 3: THE COSMOS (Environment) ---

service get_env(key: Text, default_val: Text) -> Text {
    gift val : Any = __sys_env(key);

    try {
        gift _len : HolyInt = measure(val);
        offer val;
    } repent e {
        offer default_val;
    } amen
} amen


service main() {
    behold "--- Genesis Demo ---";

    gift user : Text = get_env("USER", "Unknown Monk");
    behold ("Scribe: " + user);

    gift start_time : HolyInt = now();

    gift log : Scroll = open_scroll("genesis_demo.log", 1);

    gift ok : Bool = write_line(log, "Matins service performed by " + user);
    behold "Write success:";
    behold ok;
    close_scroll(log);

    gift duration : HolyInt = since(start_time);
    behold "Service duration (ms):";
    behold duration;
} amen
